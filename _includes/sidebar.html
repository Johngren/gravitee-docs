{% if page.sidebar != nil}

<!--  {% assign sidebar = page.sidebar | prepend: 'site.data.sidebars.' | append: '.entries' %} -->
    {% assign sidebar = site.data.sidebars.[page.sidebar].entries %}

{% else %}

{% assign sidebar_url = page.url | split: '/' %}

{% if sidebar_url[1] == "Guides" %}

  {% capture sidebar_name %}{{sidebar_url[2]}}_{{sidebar_url[3]}}_sidebar{% endcapture %}
<!--   {% assign sidebar = sidebar_name | prepend: 'site.data.sidebars.' | append: '.entries' %}-->

  {% assign sidebar = site.data.sidebars.[sidebar_name].entries %}

{% elsif sidebar_url[1] == "Getstarted" %}

  {% assign sidebar = site.data.sidebars.gettingstarted_sidebar.entries %}

{% elsif sidebar_url[1] == "Reference" %}

  {% assign sidebar = site.data.sidebars.reference_sidebar.entries %}

{% endif %}

{% endif %}

<div class="custom-links">
  <!--  <h5>{{sidebar[0].product}}</h5> -->

<!-- Version dropdown -->
{% if sidebar[0].product contains "API Management" %}
  {% assign sidebar_versions = site.data.side-nav-versions.apim_sidenav_versions %}
{% elsif sidebar[0].product contains "Access Management" %}
  {% assign sidebar_versions = site.data.side-nav-versions.am_sidenav_versions %}
{% elsif sidebar[0].product contains "Cockpit" %}
{% elsif sidebar[0].product contains "" %}
{% endif %}

    {% for entry in sidebar_versions %}
    {% for folder in entry.folders %}
      <li class="dropdown-button">
        Version<a href="#" class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b></a>
          <ul class="dropdown-menu">
            {% for folderitem in folder.folderitems %}
              {% if folderitem.external_url %}
              <li><a href="{{folderitem.external_url}}" target="_blank">{{folderitem.title}}</a></li>
              {% elsif page.url contains folderitem.url %}
              <li class="dropdownActive"><a href="{{folderitem.url}}">{{folderitem.title}}</a></li>
              {% else %}
              <li><a href="{{folderitem.url}}">{{folderitem.title}}</a></li>
              {% endif %}
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
    {% endfor %}

<!-- sidebar -->
    <ul id="mysidebar" class="nav navbar-nav">

        {% for entry in sidebar %}
        {% for folder in entry.folders %}
        {% if folder.output contains "web" %}
        <li class="subitem">
            <a href="#">{{ folder.title }}</a>
            <ul class="sub-dropdown">
                {% for folderitem in folder.folderitems %}

                {% if folderitem.output contains "web" %}
                {% if folderitem.external_url %}
                <li><a href="{{folderitem.external_url}}" target="_blank">{{folderitem.title}}</a></li>
                {% elsif page.url == folderitem.url %}
                <li class="active"><a href="{{folderitem.url}}">{{folderitem.title}}</a></li>
                {% else %}
                <li><a href="{{folderitem.url}}">{{folderitem.title}}</a></li>
                {% endif %}

                {% endif %}


                {% for subfolders in folderitem.subfolders %}
                {% if subfolders.output contains "web" %}
                <li class="subitem">
                    <a href="#">{{ subfolders.title }}</a>
                    <ul class="sub-dropdown">
                        {% for subfolderitem in subfolders.subfolderitems %}
                        {% if subfolderitem.output contains "web" %}
                        {% if subfolderitem.external_url %}
                        <li><a href="{{subfolderitem.external_url}}" target="_blank">{{subfolderitem.title}}</a></li>
                        {% elsif page.url == subfolderitem.url %}
                        <li class="active"><a href="{{subfolderitem.url}}">{{subfolderitem.title}}</a></li>
                        {% else %}
                        <li><a href="{{subfolderitem.url}}">{{subfolderitem.title}}</a></li>
                        {% endif %}
                        {% for subfolders in subfolderitem.subfolders %}
                        {% if subfolders.output contains "web" %}
                        <li class="subitem">
                            <a href="#">{{ subfolders.title }}</a>
                            <ul class="sub-dropdown">
                                {% for subfolderitem in subfolders.subfolderitems %}
                                {% if subfolderitem.output contains "web" %}
                                {% if subfolderitem.external_url %}
                                <li><a href="{{subfolderitem.external_url}}" target="_blank">{{subfolderitem.title}}</a></li>
                                {% elsif page.url == subfolderitem.url %}
                                <li class="active"><a href="{{subfolderitem.url}}">{{subfolderitem.title}}</a></li>
                                {% else %}
                                <li><a href="{{subfolderitem.url}}">{{subfolderitem.title}}</a></li>
                                {% endif %}
                                {% endif %}
                                {% endfor %}
                            </ul>
                        </li>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                {% endif %}
                {% endfor %}

                {% endfor %}
            </ul>
            {% endif %}
            {% endfor %}
            {% endfor %}
            <!-- if you aren't using the accordion, uncomment this block:
               <p class="external">
                   <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
               </p>
               -->
        </li>
    </ul>
</div>
