= Rest APIs - Notifications
:page-sidebar: apim_3_x_sidebar
:page-permalink: apim/3.x/apim_installguide_rest_apis_notifications.html
:page-folder: apim/installation-guide/rest-apis
:page-description: Gravitee.io API Management - Configuration - Management API
:page-keywords: Gravitee.io, API Platform, API Management, API Gateway, oauth2, openid, documentation, manual, guide, reference, api, notification, template, freemarker
:page-layout: apim3x

== Introduction

In APIM Console you can subscribe to notifications.

There are 3 categories of notification:

- *API*: notifications about a specific API
- *Application*: notification about a specific application
- *Portal*: notifications about the platform

There are also 3 types of notifier:

- *Portal*: This is the default notifier. Messages are sent to connected users throw the UI.
- *Email*: You can configure an email notifier that will send messages to a specific list of email.
- *Webhook*: You can configure a webhook notifier that will send an HTTP POST request to a specific URL.

== Subscription
You can subscribe to many notifications. These notifications are related to APIs, applications or more general platform events.

image:apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-subscriptions-portal.png[Subscribe to portal notifictions, 350]
image:apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-subscriptions-api.png[Subscribe to an API notifictions, 350]
image:apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-subscriptions-application.png[Subscribe to an application notifictions, 350]


== Categories of notification
=== API
|===
|Name                       |Description

|Accept API review 	        |Triggered when an API's review has been accepted
|API Deprecated 	        |Triggered when an API is deprecated
|API key Expired 	        |Triggered when an API key is expired.
|API key Renewed 	        |Triggered when an API key is renewed.
|API key Revoked 	        |Triggered when an API key is revoked.
|API Started 	            |Triggered when an API is started
|API Stopped 	            |Triggered when an API is stopped
|Ask for API review 	    |Triggered when an API can be reviewed
|Message 	                |Used when sending a custom message to an Application Role
|New Rating 	            |Triggered when a new rating is submitted
|New Rating Answer 	        |Triggered when a new answer is submitted
|New Subscription 	        |Triggered when a Subscription is created.
|New Support Ticket 	    |Triggered when a new support ticket is created
|Reject API review 	        |Triggered when an API's review has been rejected
|Subscription Accepted 	    |Triggered when a Subscription is accepted.
|Subscription Closed 	    |Triggered when a Subscription is closed.
|Subscription Paused 	    |Triggered when a Subscription is paused.
|Subscription Rejected 	    |Triggered when a Subscription is rejected.
|Subscription Resumed 	    |Triggered when a Subscription is resumed.
|Subscription Transferred 	|Triggered when a Subscription is transferred.
|===

=== APPLICATION
|===
|Name 	                    |Description

|New Subscription 	        |Triggered when a Subscription is created.
|New Support Ticket 	    |Triggered when a new support ticket is created
|Subscription Accepted 	    |Triggered when a Subscription is accepted.
|Subscription Closed 	    |Triggered when a Subscription is closed.
|Subscription Paused 	    |Triggered when a Subscription is paused.
|Subscription Rejected 	    |Triggered when a Subscription is rejected.
|Subscription Resumed 	    |Triggered when a Subscription is resumed.
|Subscription Transferred 	|Triggered when a Subscription is transferred.
|===

=== PORTAL
|===
|Name 	                    |Description

|First Login 	            |Triggered when an user log in for the first time
|Group invitation 	        |Triggered when an user is invited in a group
|Message 	                |Used when sending a custom message to an Environment Role
|New Support Ticket 	    |Triggered when a new support ticket is created
|Password Reset 	        |Triggered when a password is reset
|User Created 	            |Triggered when an user is created
|User Registered 	        |Triggered when an user is registered
|User Registration Request 	|Triggered when a new user is created and automatic validation is disabled
|===

== Notifiers
=== Portal
Portal notifier sends messages to connected users.
Notifications can be displayed by clicking on the bell icon in the top menu of the APIM Administration console

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-portal-notifier-console.png[Notifications in the APIM Administration console, 300]

In the developer portal, notifications are displayed in a specific page, accessible from user menu.

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-portal-notifier-portal.png[Notifications in the developer portal]

The templates of portal notifications can be customized in settings. See <<Templates>>

=== Email
Email notifier sends email to a specific list of email addresses.
To create a new email notifier, click on the (+) button, choose the "Default Email Notifier" type and give your notifier a name.
Then you can add one or more email addresses and subscribe to the notifications you want.

[NOTE]
====
When you create an API, a default email notifier is created. All notifications are selected and email are send to te primary owner.

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-email-notifier-api.png[Default configuration of an email notifier]
====

The templates of email notifications can be customized in settings. See <<Templates>>

=== Webhook
Webhook notifiers send an HTTP POST request to a configured URL. This request contains 2 headers and a JSON body that represents the message.
Headers are:

- `X-Gravitee-Event`: contains the event id (e.g.: API_KEY_REVOKED)
- `X-Gravitee-Event-Scope`: contains the category of the notification (e.g.: API)

The JSON body looks like this (depending on the category of the notification, some fields can be absent from the body):
```json
{
  "event": "",
  "scope": "",
  "api": {
    "id": "",
    "name": "",
    "version": ""
  },
  "application": {
    "id": "",
    "name": ""
  },
  "owner": {
    "id": "",
    "username": "",
    "owner": ""
  },
  "plan": {
    "id": "",
    "name": "",
    "security": "",
    "plan": ""
  },
  "subscription": {
    "id": "",
    "status": "",
    "subscription": ""
  }
}
```

To create a new webhook notifier, click on the (+) button, choose the "Default Webhook Notifier" type and give your notifier a name.
Then you can add the URL Gravitee will call to send notifications and subscribe to the notifications you want.


== Templates

Email and portal notification templates are based on HTML and YML files.
They are located here:
[source,yaml]
----
templates:
  path: ${gravitee.home}/templates
----

Since 3.4.0, you can override these templates within the APIM Management console.

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-templates-1.png[Templates edition in the settings]

You can also customize:

- Email templates that are sent on specific actions and not related to a notification. Most of the time, these emails are for specific users.
- The `header.html` file that is included by default in all email templates.

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-templates-2.png[Specific templates]

=== Edition
For almost all notifications, you can configure both portal and email notifications.

To customize a template, click on the switch button *Override default template* and edit the title and/or the content.

image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-templates-edition-1.png[Portal template edition, 500]
image::apim/3.x/installation/notification/graviteeio-installation-configuration-notifications-templates-edition-2.png[Email template edition, 500]


=== Attributes
In these templates, you can use http://freemarker.org[Freemarker template engine] to add specific information.
(e.g.: ${user.name} or ${api.metadata['foo-bar']}

Available attributes::
[width="100%",cols="20%,20%,20%,20%,20%,20%",frame="topbot",options="header"]
|======================
|Api                |Application        |Group              |Plan               |Owner/User    |Subscription
|name               |name               |name               |name               |username      |status
|description        |description        |-                  |description        |firstname     |request
|version            |type               |-                  |order              |lastname      |reason
|role               |status             |-                  |publishedAt (Date) |displayName   |processedAt
|metadata (Map)     |role               |-                  |closedAt (Date)    |email         |startingAt
|deployedAt (Date)  |-                  |-                  |-                  |-             |endingAt
|createdAt (Date)   |createdAt (Date)   |createdAt (Date)   |createdAt (Date)   |-             |closedAt
|updatedAt (Date)   |updatedAt (Date)   |updatedAt (Date)   |updatedAt (Date)   |-             |subscribedAt
|======================

Here's an example of template:
[source,html]
----
<html>
	<body style="text-align: center;">
		<header>
			<#include "header.html" />
		</header>
		<div style="margin-top: 50px; color: #424e5a;">
			<h3>Hi ${owner.username},</h3>
			<p>The API Key <code>${apiKey}</code> has been expired.
		</p>
	</body>
</html>

----